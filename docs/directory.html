<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Credential Manager</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="star.js"></script>
  </head>
  <body>
    <center>
      <a href="/">‚ÜêBack</a><br />
      <p>Credential Lister</p>
      <br />
      <button onclick="fetchcreds()">Fetch Credentials</button><br />
      <h1>Credential Directory Viewer</h1>
      <textarea id="credbox" rows="4" cols="50"></textarea><br />
      <p>Credential Puller</p>
      <br />
      <input value="1.onc" placeholder="Onc file to view" id="credname" />
      <textarea id="fetchbox" rows="4" cols="50"></textarea><br />
      <button onclick="pushcreds()">Pull Credentials</button>
    </center>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetchcreds(); // Call fetchcreds on page load
      });

      function fetchcreds() {
        var credbox = document.getElementById("credbox");
        credbox.value = ""; // Clear previous content

        // Assuming /creds is the folder where credential files are stored
        var folderPath = "/creds/";

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4) {
            if (xhr.status == 200) {
              var files = xhr.responseText.split("\n");

              // Iterate through each file and fetch its content
              files.forEach(function (file) {
                var fileXHR = new XMLHttpRequest();
                fileXHR.onreadystatechange = function () {
                  if (fileXHR.readyState == 4 && fileXHR.status == 200) {
                    // Append file content to the credbox textarea
                    credbox.value += fileXHR.responseText + "\n";
                  }
                };
                fileXHR.open("GET", folderPath + file, true);
                fileXHR.send();
              });
            } else {
              console.error(
                "Failed to retrieve file list. Status: " + xhr.status,
              );
            }
          }
        };
        xhr.open("GET", folderPath, true);
        xhr.send();
      }

      function pushcreds() {
        var credname = document.getElementById("credname").value;
        var fetchbox = document.getElementById("fetchbox");
        fetchbox.value = ""; // Clear previous content

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4) {
            if (xhr.status == 200) {
              // Displaying contents in the fetchbox textarea
              fetchbox.value = xhr.responseText;
            } else {
              console.error(
                "Failed to fetch credentials. Status: " + xhr.status,
              );
            }
          }
        };
        xhr.open("GET", credname, true);
        xhr.send();
      }
    </script>
  </body>
</html>
